#!/bin/bash

# Log startup
echo "[$(date)] wrapper.sh started" >> /tmp/n8n-mcp-wrapper.log
echo "[$(date)] PATH: $PATH" >> /tmp/n8n-mcp-wrapper.log
echo "[$(date)] which node: $(which node)" >> /tmp/n8n-mcp-wrapper.log
echo "[$(date)] node version: $(node --version 2>&1)" >> /tmp/n8n-mcp-wrapper.log

# Find the script directory
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
echo "[$(date)] Script dir: $SCRIPT_DIR" >> /tmp/n8n-mcp-wrapper.log

# Try different node paths
if command -v node >/dev/null 2>&1; then
    NODE_CMD="node"
elif [ -x "/usr/local/bin/node" ]; then
    NODE_CMD="/usr/local/bin/node"
elif [ -x "/opt/homebrew/bin/node" ]; then
    NODE_CMD="/opt/homebrew/bin/node"
else
    echo "[$(date)] ERROR: Could not find node" >> /tmp/n8n-mcp-wrapper.log
    exit 1
fi

echo "[$(date)] Using node: $NODE_CMD" >> /tmp/n8n-mcp-wrapper.log

# Run the actual script
exec "$NODE_CMD" "$SCRIPT_DIR/absolute-minimal.js"